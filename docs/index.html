<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R interface to 'TensorFlow' Datasets API • tfdatasets</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">tfdatasets</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/tfdatasets">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The TensorFlow Dataset API provides various facilities for creating scalable input pipelines for TensorFlow models, including:</p>
<ul>
<li><p>Reading data from a variety of formats including CSV files and <a href="https://www.tensorflow.org/api_guides/python/python_io#tfrecords_format_details">TFRecords files</a> (the standard binary format for TensorFlow training data).</p></li>
<li><p>Transforming datasets in a vareity of ways including mapping arbitrary functions against them.</p></li>
<li><p>Shuffling, batching, and repeating datasets over a number of epochs.</p></li>
<li><p>Streaming interface to data for reading arbitrarily large datasets.</p></li>
<li><p>Reading and transforming data are TensorFlow graph operations, so are executed in C++ and in parallel with model training.</p></li>
</ul>
<p>The R interface to TensorFlow datasets provides access to the Dataset API, including high-level convenenice functions for easy integration with the <a href="https://tensorflow.rstudio.com/keras">keras</a> and <a href="https://tensorflow.rstudio.com/tfestimators">tfestimators</a> R packages.</p>
</div>
<div id="creating-a-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-dataset" class="anchor"></a>Creating a Dataset</h2>
<p>To create a dataset, use one of the <a href="reference/index.html#section-creating-datasets">dataset creation</a> functions. For example, to create a dataset from a CSV file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tfdatasets)
dataset &lt;-<span class="st"> </span><span class="kw"><a href="reference/csv_dataset.html">csv_dataset</a></span>(<span class="st">"iris.csv"</span>)</code></pre></div>
<p>Dataset columns and data types are detected automatically by reading up to the first 1000 lines of the CSV file. You can provide explicit column names and/or data types using the <code>col_names</code> and <code>record_defaults</code> parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset &lt;-<span class="st"> </span><span class="kw"><a href="reference/csv_dataset.html">csv_dataset</a></span>(<span class="st">"iris.csv"</span>,
  <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">"SepalLength"</span>, <span class="st">"SepalWidth"</span>, <span class="st">"PetalLength"</span>, <span class="st">"PetalWidth"</span>, <span class="st">"Species"</span>),
  <span class="dt">record_defaults =</span> <span class="kw">list</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, 0L)
)</code></pre></div>
<p>The <code>record_defaults</code> parameter serves as both type information and as a default for missing values. Supported types are numeric, integer, and character.</p>
</div>
<div id="transformations" class="section level2">
<h2 class="hasAnchor">
<a href="#transformations" class="anchor"></a>Transformations</h2>
<p>You can map arbitrary transformation functions onto dataset records using the <code><a href="reference/dataset_map.html">dataset_map()</a></code> function. For example, to transform the “Species” column into a one-hot encoded vector you would do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_map.html">dataset_map</a></span>(<span class="cf">function</span>(record) {
    record<span class="op">$</span>Species &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">one_hot</span>(record<span class="op">$</span>Species, 3L)
    record
  })</code></pre></div>
<p>Note that while <code><a href="reference/dataset_map.html">dataset_map()</a></code> applies an R function, there are some special constraints on this function which allow it to execute <em>not within R</em> but rather within the TensorFlow graph.</p>
<p>For a dataset created with the <code><a href="reference/csv_dataset.html">csv_dataset()</a></code> function, the passed record will be named list of tensors (one for each column of the dataset). The return value should be another set of tensors which were created from TensorFlow functions (e.g. <code>tf$one_hot</code> as illustrated above). This function will be converted to a TensorFlow graph operation that performs the transformation within native code.</p>
</div>
<div id="shuffling-and-batching" class="section level2">
<h2 class="hasAnchor">
<a href="#shuffling-and-batching" class="anchor"></a>Shuffling and Batching</h2>
<p>There are functions which control how batches are drawn from the dataset. For example, the following specifes that data will be drawn in batches of 128 from a shuffled buffer of 5000 records, and that the dataset will be repeated for 10 epochs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_shuffle.html">dataset_shuffle</a></span>(<span class="dv">5000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_batch.html">dataset_batch</a></span>(<span class="dv">128</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_repeat.html">dataset_repeat</a></span>(<span class="dv">10</span>)</code></pre></div>
</div>
<div id="reading-batches" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-batches" class="anchor"></a>Reading Batches</h2>
<p>Batches are read from datasets using tensors (e.g. a tensor for the features matrix and a tensor for the response variable). You can obtain the tensor(s) for a dataset by calling the <code><a href="reference/batch_from_dataset.html">batch_from_dataset()</a></code> function.</p>
<p>A very simple example consists of creating a dataset of constant tensors and then reading it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sess &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Session</span>()
dataset &lt;-<span class="st"> </span><span class="kw"><a href="reference/tensor_slices_dataset.html">tensor_slices_dataset</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_batch.html">dataset_batch</a></span>(<span class="dv">5</span>)
batch &lt;-<span class="st"> </span><span class="kw"><a href="reference/batch_from_dataset.html">batch_from_dataset</a></span>(dataset)
sess<span class="op">$</span><span class="kw">run</span>(batch)</code></pre></div>
<pre><code>[1] 1 2 3 4 5</code></pre>
<p>The <code><a href="reference/batch_from_dataset.html">batch_from_dataset()</a></code> function also supports yielding batches segregated into feature and response elements (assuming that the dataset consists of a set of named columns). For example, here we create a batch tensor organized into a feature matrix and response array:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sess &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Session</span>()
dataset &lt;-<span class="st"> </span><span class="kw"><a href="reference/csv_dataset.html">csv_dataset</a></span>(<span class="st">"tests/testthat/data/mtcars.csv"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_batch.html">dataset_batch</a></span>(<span class="dv">5</span>)
batch &lt;-<span class="st"> </span><span class="kw"><a href="reference/batch_from_dataset.html">batch_from_dataset</a></span>(dataset, <span class="dt">features =</span> <span class="kw">c</span>(mpg, disp), <span class="dt">response =</span> cyl)
sess<span class="op">$</span><span class="kw">run</span>(batch)</code></pre></div>
<pre><code>$x
     [,1] [,2]
[1,] 21.0  160
[2,] 21.0  160
[3,] 22.8  108
[4,] 21.4  258
[5,] 18.7  360

$y
[1] 6 6 4 6 8</code></pre>
</div>
<div id="using-with-tfestimators" class="section level2">
<h2 class="hasAnchor">
<a href="#using-with-tfestimators" class="anchor"></a>Using with tfestimators</h2>
<p>Models created with <strong>tfestimators</strong> use an input function to consume data for training, evaluation, and prediction. For example, here is an example of using an input function to feed data from an R data frame to tfestimators model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">train</span>(
  <span class="kw">input_fn</span>(mtcars, <span class="dt">features =</span> <span class="kw">c</span>(drat, cyl), <span class="dt">response =</span> mpg,
           <span class="dt">batch_size =</span> <span class="dv">128</span>, <span class="dt">epochs =</span> <span class="dv">3</span>)
)</code></pre></div>
<p>To use <strong>tfdatasets</strong> with a dataset streamed from a CSV instead you would do the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset &lt;-<span class="st"> </span><span class="kw"><a href="reference/csv_dataset.html">csv_dataset</a></span>(<span class="st">"mtcars.csv"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_batch.html">dataset_batch</a></span>(<span class="dv">128</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="reference/dataset_repeat.html">dataset_repeat</a></span>(<span class="dv">3</span>)

model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">train</span>(
  <span class="kw"><a href="reference/input_fn_from_dataset.html">input_fn_from_dataset</a></span>(dataset, <span class="dt">features =</span> <span class="kw">c</span>(drat, cyl), <span class="dt">response =</span> mpg)
)</code></pre></div>
<p>The <code><a href="reference/input_fn_from_dataset.html">input_fn_from_dataset()</a></code> function uses the <code><a href="reference/batch_from_dataset.html">batch_from_dataset()</a></code> function under the hood to provide the <code>input_fn</code> interface expected by tfestimators models.</p>
</div>
<div id="using-with-keras" class="section level2">
<h2 class="hasAnchor">
<a href="#using-with-keras" class="anchor"></a>Using with Keras</h2>
</div>
<div id="batch-iteration" class="section level2">
<h2 class="hasAnchor">
<a href="#batch-iteration" class="anchor"></a>Batch Iteration</h2>
<p>In the <a href="#reading-batches">Reading Batches</a> section above we demonstrated evaluating the tensors returned from <code><a href="reference/batch_from_dataset.html">batch_from_dataset()</a></code>. If you want to interate over all batches of a dataset, you will need to detect the end of the iteration. This is handled automatically when you use tfestiamtors or keras, however if you are dealing with the tensors directly you need to do this explicitly.</p>
<p>When the iterator has exhausted all available elements a a runtime error will occur. You can use the <code><a href="reference/out_of_range_error.html">out_of_range_error()</a></code> function to distinguish this error from other errors which may have occurred during iteration. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tfdatasets)
dataset &lt;-<span class="st"> </span><span class="kw"><a href="reference/csv_dataset.html">csv_dataset</a></span>(<span class="st">"training.csv"</span>) 
  <span class="kw"><a href="reference/dataset_batch.html">dataset_batch</a></span>(<span class="dv">128</span>) 
  <span class="kw"><a href="reference/dataset_repeat.html">dataset_repeat</a></span>(<span class="dv">10</span>)
  
batch &lt;-<span class="st"> </span><span class="kw"><a href="reference/batch_from_dataset.html">batch_from_dataset</a></span>(dataset, <span class="dt">features =</span> <span class="kw">c</span>(mpg, disp), <span class="dt">response =</span> cyl)
<span class="kw">tryCatch</span>({
  <span class="cf">while</span>(<span class="ot">TRUE</span>) {
    <span class="co"># use batch$x and batch$y tensors</span>
  }
},
<span class="dt">error =</span> <span class="cf">function</span>(e) {
  <span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="reference/out_of_range_error.html">out_of_range_error</a></span>())
    <span class="kw">stop</span>(e)
})</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2 class="hasAnchor">
<a href="#sidebar" class="anchor"></a>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/rstudio/tfdatasets">https://​github.com/​rstudio/​tfdatasets</a>
</li>
<li>Report a bug at <br><a href="https://github.com/rstudio/tfdatasets/issues">https://​github.com/​rstudio/​tfdatasets/​issues</a>
</li>
</ul>
<h2>License</h2>
<p>Apache License 2.0</p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>JJ Allaire <br><small class="roles"> Author, maintainer </small> </li>
<li>Yuan Tang <br><small class="roles"> Author </small> </li>
<li>Kevin Ushey <br><small class="roles"> Author </small> </li>
<li>
<a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" height="24"></a> <br><small class="roles"> Copyright holder, funder </small> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by JJ Allaire, Yuan Tang, Kevin Ushey, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
